import Head from "next/head";
import { Galery } from "../components/DetailsTours/Galery";
import { Itinerary } from "../components/DetailsTours/Itinerary";
import { Nav } from "../components/DetailsTours/Nav";
import { Items } from "../components/DetailsTours/Items";
import Image from "next/image";
import styles from "../styles/detailsTours/DetailTours.module.scss";
import { useState, useEffect } from "react";
import { getPackageById } from "../store/actions/Packages/packagesActions";
import { useDispatch } from "react-redux";

export default function DetailTours() {
  const [packageId, setPackageId] = useState("");
  const [packageInfo, setPackageInfo] = useState("");

  const dispatch = useDispatch();

  useEffect(() => {
    const string = window.location.href;
    const url = new URL(string);
    const id = url.searchParams.get("id");
    setPackageId(id);
  }, []);

  useEffect(() => {
    getPackage();
  }, [packageId]);

  const getPackage = async () => {
    if (packageId) {
      const response = await dispatch(getPackageById(packageId));
      if (response.payload === 500) {
        alert("Package not found");
      }
      setPackageInfo(response.payload);
      console.log(response.payload);
    }
  };

  return (
    <div>
      <Head>
        <title>Turistic Life</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
        <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossOrigin="anonymous"
        ></link>
      </Head>
      <Image
        width={700}
        height={300}
        layout="responsive"
        src="/images/detailTour.jpg"
      />
      <Items packageInfo={packageInfo} />
      <Nav />
      <hr></hr>
      <Itinerary />
      <hr></hr>
      <Galery />
      <hr></hr>
    </div>
  );
}
