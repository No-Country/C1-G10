import Head from "next/head";
import { Items } from "../components/DetailsTours/Items";
import { useState, useEffect } from "react";
import { getPackageById } from "../store/actions/Packages/packagesActions";
import { useDispatch } from "react-redux";
import { TourInfo } from "../components/DetailsTours/TourInfo";
import styles from "../styles/detailsTours/TourInfo.module.scss";
import { LoadingScreen } from "../components/LoadingScreen/LoadingScreen";
import { Checkout } from "../components/DetailsTours/Checkout";

export default function DetailTours() {
  const [packageId, setPackageId] = useState("");
  const [packageInfo, setPackageInfo] = useState("");
  const [loading, setLoading] = useState(true);

  const dispatch = useDispatch();

  useEffect(() => {
    const url = new URL(window.location.href);
    const id = url.searchParams.get("id");
    setPackageId(id);
  }, []);

  useEffect(() => {
    getPackage();
  }, [packageId]);

  const getPackage = async () => {
    if (packageId) {
      const response = await dispatch(getPackageById(packageId));
      if (response.payload === 500) {
        alert("Package not found");
      }
      setPackageInfo(response.payload);
      setLoading(false);
    }
  };

  return loading ? (
    <LoadingScreen />
  ) : (
    <div>
      <Head>
        <title>The Best Options</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
        <link
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
          crossOrigin="anonymous"
        ></link>
      </Head>
      <div
        className={styles.bgimg}
        style={{ backgroundImage: `url(${packageInfo.images[0]})` }}
      >
        <h3>{packageInfo.packageName}</h3>
      </div>
      <Items packageInfo={packageInfo} />
      <hr></hr>
      <Checkout packageInfo={packageInfo} />
      <TourInfo packageInfo={packageInfo} />
    </div>
  );
}
